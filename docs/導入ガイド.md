---
title: 導入ガイド（はじめての方向け・かんたん手順）
status: stable
last_updated: 2025-09-05
---

# このガイドでできること

- ローカルPCのCLI（例: gas-admin）から、Google Apps Script（GAS）の「取得・更新・実行（テスト）・バージョン作成・デプロイ管理」をできるようにします。
- 導入は「GASのWebアプリ（管理プロキシ）」を1つ作って、そのURLをCLIに教えるだけです。

# 用語（かんたん）

- 管理プロキシ: GASのWebアプリ。CLIからの操作を受付け、Google公式のAPIを代理で実行します。
- 対象GAS: あなたが操作したいGASプロジェクト（スクリプトIDで指定します）。
- AdminShim: 対象GASに入れる小さな補助ファイル（トリガー/プロパティの操作用）。

# 導入の全体像（5ステップ）

1) 管理プロキシ（GAS Webアプリ）を新規作成して公開する
2) WebアプリのURL（…/exec）を控える
3) ローカルCLIをインストールする
4) CLIにWebアプリのURLと初期設定を入れる
5) 試しに通信テスト・取得をしてみる

# ステップ1: 管理プロキシ（GAS Webアプリ）を作る

1. Googleアカウントで https://script.google.com/ にアクセス →「新しいプロジェクト」
2. 画面左の「エディタ」で、`appsscript.json` を以下内容で置き換え（[プロジェクトの設定]→「マニフェストファイルを表示」）。

```
{
  "timeZone": "Asia/Tokyo",
  "exceptionLogging": "STACKDRIVER",
  "oauthScopes": [
    "https://www.googleapis.com/auth/script.projects",
    "https://www.googleapis.com/auth/script.deployments",
    "https://www.googleapis.com/auth/script.scriptapp",
    "https://www.googleapis.com/auth/script.external_request",
    "https://www.googleapis.com/auth/drive.readonly"
  ]
}
```

3. エディタのコードに、`code/gas_web_proxy/Code.gs` の内容をそのまま貼り付けます。
   - そのままでも使えます。
   - 社内運用などでセキュリティを高めたい場合は、ファイル上部の `CONFIG` を設定してください。
     - `ENABLE_GUARD` を `true` に変更
     - `TOKEN` を十分に長い秘密値へ
     - `ALLOW` に操作を許可する scriptId を配列で登録

4. メニュー「デプロイ」→「新しいデプロイ」→「種類を選択」で「ウェブアプリ」。
   - 実行するユーザー:
     - かんたん運用（おすすめ）→「自分」
   - アクセスできるユーザー:
     - 「全員（リンクを知っている全員）」など用途に合わせて選択
   - 画面の指示に従ってデプロイし、URL（…/exec）を控えます。

ポイント: 「自分として実行」＋トークン/許可リスト（上のCONFIG）があれば、CLIでの利用が簡単です。

# ステップ2: WebアプリのURLを控える

- デプロイ完了画面に表示される「ウェブアプリのURL（…/exec）」をコピーします。
- あとでCLIに設定します。

# ステップ3: ローカルCLIをインストール

このリポジトリに最小CLIが含まれています（Node.jsが必要）。

1. Node.js をインストール（わからなければ公式サイトからインストーラでOK）
2. ターミナル/コマンドプロンプトを開き、以下を実行：

```
cd code/cli
npm i
chmod +x cli.js   # Windowsは不要
npm link          # 権限が必要な場合は管理者で実行
```

成功すると `gas-admin` コマンドが使えるようになります。

# ステップ4: CLIの初期設定

1. 次を実行：

```
gas-admin setup
```

2. 質問に答えます。
   - Profile name: お好みの名前（例: default）
   - Web App endpoint: ステップ2で控えた `…/exec` URL
   - Mode: 「2」を選ぶ（Owner-Proxy / token）→ 簡単です
   - X-Admin-Token: `Code.gs` の `CONFIG.TOKEN` と同じ値
   - Default scriptId: よく使う対象GASがあれば入れる（後から変えられます）

# ステップ5: 通信テストと基本動作

1. 疎通テスト

```
gas-admin whoami
```

2. 対象GASの中身を取得（scriptIdがわかる場合）

```
gas-admin get 1AbCdEfGhIjKlMnOpQrStUvWxYz...
```

3. AdminShim を自動導入（トリガーやプロパティを扱う場合）

```
gas-admin shim:ensure 1AbCdEfGhIjKlMnOpQrStUvWxYz...
```

これで準備完了です。使い方は「利用ガイド」をご覧ください。

# よくある質問（導入時）

Q. scriptId はどこで確認できますか？
- A. GASエディタの「プロジェクト設定」→「スクリプトID」に表示されます。

Q. whoami がエラーになります
- A. `Code.gs` のCONFIGで `ENABLE_GUARD=true` にしている場合、`TOKEN` と `ALLOW` の設定、`gas-admin setup` 時に入れたトークンが一致しているか確認してください。

Q. Node.js を入れたくありません
- A. 可能なら既存のPCに Node.js を入れて CLI を使うのがおすすめです。難しい場合は、ブラウザや他ツールから WebアプリURL に JSON をPOSTして利用もできます（技術者にサポートを依頼してください）。

