---
title: 01_全体概要（Purpose / Scope / Context）
status: draft-2
last_updated: 2025-09-05
---

# 1. 目的（Purpose）

- GAS プロジェクトの取得・更新・実行・バージョン管理・デプロイ・トリガー/プロパティ操作を、Codex CLI / gemini CLI / ClaudeCode 等のローカル AI/CLI から安全かつ一貫した手続きで遂行できるようにする。
- 権限境界は「ログイン中ユーザー」または「管理者代行」に明確化し、運用モードごとに防御策を定義する。ローカル CLI からの利用容易性を最優先し、既定は「代行運用（X-Admin-Token + Allowlist）」を推奨する。

# 2. 範囲（Scope）

- 含む：
  - Web アプリ（管理プロキシ）：Apps Script API v1 呼び出し、scripts.run 正規化、統一レスポンス。
  - 対象GAS側 AdminShim：トリガー/プロパティの管理関数群。
  - クライアント（AI/CLI）からの利用指針・再試行方針・安全な差分更新手順。
- 含まない：
  - CLASP 同期の完全代替（補助としての利用は可）。
  - ブラウザ直接呼出の UX（CORS/ログイン依存のため非推奨）。

# 3. 成果物（Deliverables）

- 管理プロキシ Web アプリ実装（Code.gs, appsscript.json スコープ）。
- AdminShim（AdminShim.gs）テンプレート。
- 仕様書（本ドキュメント群）とセットアップ手順（draft 内既存手順を参照）。

# 3.1 クイックスタート（導入 5 ステップ）

1) 新規 GAS プロジェクトを作成し、`appsscript.json` に必要スコープを設定。
2) `Code.gs` に管理プロキシ本体を貼付し、Web アプリとしてデプロイ。
3) 運用モードを選択（推奨: 代行運用）し、`X-Admin-Token` と `scriptId Allowlist` を設定。
4) ローカルで最小 CLI（gas-admin 互換）をセットアップし、`endpoint` と `X-Admin-Token` を保存。
5) `gas-admin get/update/run/version/deploy` で一連の CI/CD を実行。

# 4. ステークホルダー（Stakeholders）

- オーナー/開発者：本システムの導入・運用・保守責任者。
- AI エージェント/CLI 利用者：GAS プロジェクトの操作担当。
- 対象GASの共同編集者：アクセス権を共有し、本システムによる更新の影響を受ける主体。

# 5. 成功基準（Success Criteria）

- 主要操作（get/update、run、version/deploy）が単一エンドポイントと数個の CLI コマンドで完結。
- 権限制御が期待どおり（ユーザー権限/代行運用）に機能。
- updateContent の誤消去等に対するバックアップ/復旧手順が確立。
- エラー発生時、logs と error.stack の情報から自動修正ループを実行可能。

# 6. 背景と設計方針（Context & Principles）

- Apps Script API v1 の制約（全置換更新など）を前提に、クライアント側で三方差分/バックアップを必須化。
- scripts.run を用い、未バージョンの最新コードで迅速なデバッグ実行（devMode:true）を許可。
- トリガー/プロパティは AdminShim を介した run 経由で提供し、機能境界を明確化。
