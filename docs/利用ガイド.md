---
title: 利用ガイド（日々の使い方・トラブル対応）
status: stable
last_updated: 2025-09-05
---

# 前提

- 「導入ガイド」を完了し、`gas-admin setup` まで済んでいること。
- WebアプリのURLと（必要なら）トークン設定が終わっていること。

# 1. よく使う基本操作（順番のおすすめ）

- 1) 取得（バックアップ）

```
gas-admin get <scriptId?>
```

備考: `update` は「全置換」なので、更新前に必ずバックアップを取る（JSON保存など）。

- 2) 更新（全置換）

```
gas-admin update <scriptId?> files.json
```

files.json は、Apps Script API の `files` 配列（`[{name,type,source}, ...]`）。

- 3) 実行（デバッグ）

```
gas-admin run <scriptId?> <関数名> '[<引数のJSON配列>]'
```

実行結果は JSON で表示。`logs` と `error.stack` を確認し、修正→再試行します。

- 4) バージョン作成

```
gas-admin version <scriptId?> "説明文"
```

- 5) デプロイ（公開/差し替え）

新規公開：

```
gas-admin deploy <scriptId?> <versionNumber> "説明文"
```

既存の差し替え：

```
gas-admin depl:list <scriptId?>
gas-admin depl:update <scriptId?> <deploymentId> <versionNumber> "説明文"
```

# 2. バージョン管理・一覧

```
gas-admin versions:list <scriptId?>
```

作成済みのバージョンを確認できます。最新を選び `deploy` に使います。

# 3. トリガー管理（AdminShim 必須）

まず一度だけシム導入：

```
gas-admin shim:ensure <scriptId?>
```

一覧：

```
gas-admin trig:list <scriptId?>
```

追加（5分間隔で `tick` を実行）：

```
gas-admin trig:add <scriptId?> tick 5
```

削除（ハンドラー名で一括）：

```
gas-admin trig:del <scriptId?> tick
```

# 4. プロパティ管理（AdminShim 必須）

一覧：

```
gas-admin prop:list <scriptId?> script
```

設定：

```
gas-admin prop:set <scriptId?> script '{"API_KEY":"xxx","ENV":"prod"}'
```

削除：

```
gas-admin prop:del <scriptId?> script API_KEY
```

# 5. files.json の作り方（例）

HTML を含む例：

```
[
  {"name":"Index","type":"HTML","source":"<!doctype html><html><body><?= name ?></body></html>"},
  {"name":"Code","type":"SERVER_JS","source":"function doGet(){ const t=HtmlService.createTemplateFromFile('Index'); t.name='World'; return t.evaluate(); }"},
  {"name":"appsscript","type":"JSON","source":"{ \"timeZone\":\"Asia/Tokyo\" }"}
]
```

注意: `update` は全置換。不要なファイルは永続的に削除されます。必ず最新取得→マージ→更新の順で作成してください。

# 6. 複数アカウント/環境の切り替え

プロファイルを複数作って切替できます。

```
gas-admin setup          # 新しいプロファイルを作成
gas-admin profile:list   # 一覧
gas-admin profile:use dev
```

# 7. よくあるトラブルと対処

- 401/403（認証・権限エラー）
  - Webアプリの「実行者/アクセス権」設定を確認
  - `Code.gs` の `CONFIG`（トークン/許可リスト）と CLI の設定値が一致しているか
  - 対象GASがあなたと共有済みか（ユーザー権限モードの場合）

- Missing required param（パラメータ不足）
  - コマンドの引数や `files.json` の形式を確認

- ERR_ADMIN_SHIM_MISSING / CONFLICT（シム未導入/競合）
  - `shim:ensure` を実行。競合の場合は既存 `AdminShim` の内容を確認し、必要ならバックアップ後に入替

- 更新後にファイルが消えた
  - `update` は全置換。必ず更新前に `get` でバックアップを取り、差分マージしてから `update` を実行

- レート制限
  - 短時間に大量操作すると失敗することがあります。少し待ってから再実行してください。

# 8. 安全運用のコツ

- 毎回最初に `gas-admin get` を実行して、作業用バックアップを残す
- 修正は小さく→`run` でテスト→OKなら `version`→`depl:update` の順で公開
- トークンは第三者と共有しない。不要になったら早めに変更（`CONFIG.TOKEN` の再設定→再デプロイ）

# 9. 参考: 変更の戻し方（簡易）

1) 直前の `get` で保存した `files.json` を使い、`update` で戻す

```
gas-admin update <scriptId?> files_backup.json
```

2) もしくは、直前のバージョン番号に戻して `depl:update` で差し替える

```
gas-admin versions:list <scriptId?>
gas-admin depl:update <scriptId?> <deploymentId> <旧versionNumber>
```

